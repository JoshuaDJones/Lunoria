@using Eldoria.BlazorClient.Components.Typography
@using Eldoria.BlazorClient.Components.Buttons

<div class="@RootClasses" @attributes="AdditionalAttributes">
    @if (!string.IsNullOrWhiteSpace(Title))
    {
        <TextBlock Size="TextSize.Lg" Color=@(Theme == InputTheme.light ? TextColor.white : TextColor.black)>@Title</TextBlock>
    }

    <div class="@InputContainerClasses">
        <input class="input"
               @onfocus="() => IsFocused = true"
               @onblur="() => IsFocused = false"
               type="@(IsPassword && !IsPasswordVisible ? "password" : "text")"
               value="@Value"
               @oninput="HandleInput" />

        @if (IsPassword)
        {
            <IconButton OnClick="TogglePasswordVisibility"
                        IconClass="@PasswordIconClass" />
        }
    </div>
</div>


@code {
    [Parameter] public string? Title { get; set; }
    [Parameter] public InputTheme Theme { get; set; } = InputTheme.dark;
    [Parameter] public bool IsPassword { get; set; } = false;
    [Parameter] public bool IsValid { get; set; } = true;

    [Parameter] public string? Class { get; set; }
    [Parameter(CaptureUnmatchedValues = true)]
    public Dictionary<string, object>? AdditionalAttributes { get; set; }

    [Parameter] public string? Value { get; set; }
    [Parameter] public EventCallback<string?> ValueChanged { get; set; }

    public bool IsFocused { get; set; }
    public bool IsPasswordVisible { get; set; }

    private string RootClasses =>
        string.Join(" ",
        new[]
        {
            "inputTitleContainer",
            Class
        }.Where(c => !string.IsNullOrWhiteSpace(c)));

    private string InputContainerClasses =>
        string.Join(" ",
        new[]
        {
            "inputContainer",
            Theme == InputTheme.light ? "lightInputBorder text-white" : "darkInputBorder text-black",
            !IsValid ? "invalidInputContainer" : null,
            IsFocused ? "focusedInputContainer" : null
        }.Where(c => !string.IsNullOrWhiteSpace(c)));

    private string PasswordIconClass =>
        $"fa-solid {(IsPasswordVisible ? "fa-eye" : "fa-eye-slash")}";

    private async Task HandleInput(ChangeEventArgs e)
    {
        Value = e.Value?.ToString();
        await ValueChanged.InvokeAsync(Value);
    }

    private void TogglePasswordVisibility()
    {
        IsPasswordVisible = !IsPasswordVisible;
    }
}
